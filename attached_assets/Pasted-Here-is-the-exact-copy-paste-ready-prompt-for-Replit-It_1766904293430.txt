Here is the exact, copy-paste-ready prompt for Replit.
It includes all decisions we finalized:
	•	Unify all overlays into one selector
	•	Remove the special basin toggle
	•	Add the three new overlays (Constraint Skeleton, Stability Field, Gradient Flow)
	•	Maintain progressive disclosure
	•	Keep main view clean
	•	All functionality unchanged except the Overlay Selector refactor

This prompt is designed so Replit can implement without asking questions.

⸻

✅ FULL IMPLEMENTATION PROMPT FOR REPLIT

(Copy/paste exactly as-is)

⸻

SYSTEM TASK: OVERLAY SYSTEM REFACTOR — IMPLEMENT EXACTLY AS SPECIFIED

You are updating the existing application to use a unified overlay architecture.
Below is the precise specification. Implement each part faithfully.

⸻

1. Core Requirements

A. Remove the existing Basin toggle from the main view
	•	The main visualization should have no basin toggle, no overlay buttons, no extra UI elements.
	•	The main view should remain clean, uncluttered, and default.

B. Create a single unified overlay selector

This selector appears only in Dual View, not in the main view.

The selector must include the following overlays:
	1.	Basins
	2.	Curvature Map
	3.	Tension Field
	4.	Coupling Field
	5.	Variance Map
	6.	Criticality Map
	7.	Constraint Skeleton (new)
	8.	Stability Field (new)
	9.	Gradient Flow Lines (new)

Selector form should be whichever is simplest to implement:
	•	Dropdown menu (preferred)
OR
	•	Vertical list of selectable buttons

No toggles per overlay — only one active overlay at a time.

C. Behavior in Dual View

Dual view shows:
	•	Left panel → Primary Field
	•	Right panel → Overlay View that changes based on selector choice

Overlay View should update instantly when a different overlay is chosen.

D. Progressive disclosure
	•	If user never enters Dual View, they never see overlays.
	•	If user enters Dual View → selector is visible.
	•	No overlays appear anywhere else.

⸻

2. Architecture Expectations

A. This is not a new rendering system

You should reuse the existing rendering logic for:
	•	Basins
	•	Curvature
	•	Tension
	•	Variance
	•	Coupling
	•	Criticality

B. Implement THREE new overlays

You will generate visualizations approximating each described field using the existing simulation arrays:

1. Constraint Skeleton
Goal: highlight structural boundaries where local gradients shift direction.

Implementation hint:
	•	Detect sign changes in partial derivatives
	•	Render thin line structures
	•	Skeleton should look like “bone-like frames” beneath the field.

2. Stability Field
Goal: show where the system is stabilizing vs destabilizing.

Implementation hints:
	•	Compute second derivative curvature or variance derivative
	•	Stable zones = cooler colors
	•	Destabilizing zones = warmer colors

3. Gradient Flow Lines
Goal: visualize directional flow of the field.

Implementation hints:
	•	Compute vector field from gradients
	•	Downsample for performance
	•	Render arrows or streamlines showing “movement tendencies”

Replit may choose the simplest method available.

⸻

3. Integration With Existing UI

A. Dual View Layout

Ensure the layout remains:
	•	Left: main field
	•	Right: overlay field
	•	Overlay selector above or next to the overlay field

B. Status Line Integration

The status line should NOT move or change behavior.
But overlay changes should trigger a status update event:

Examples:
	•	“Overlay changed: Basins”
	•	“Overlay changed: Criticality Map”
	•	“Overlay changed: Gradient Flow Lines”

Use the wording appropriate for each overlay.

⸻

4. Do NOT modify these subsystems
	•	Simulation core
	•	Field update loop
	•	Regime system
	•	Interpretation modes
	•	Metrics panel
	•	Diagnostic console
	•	Shortcuts (Ctrl+Shift+D remains diagnostic toggle)
	•	Visual style/theme

This task ONLY concerns the overlay architecture.

⸻

5. Acceptance Criteria

Implementation is complete when:
	1.	Main view has no basin toggle
	2.	Dual view displays an Overlay Selector
	3.	Selector includes all 9 overlays
	4.	Only one overlay active at a time
	5.	All overlays render correctly in the right panel
	6.	New overlays produce meaningful, distinct visual patterns
	7.	No UI elements appear outside Dual View
	8.	No regressions occur in simulation, regime behavior, or metrics

⸻

6. Stretch Goal (Optional — Only if trivial)

If effortless:
	•	Allow overlay selector to remember the last chosen overlay when switching regimes.
If not trivial → skip.

⸻

Proceed with implementation.

⸻

If you want, I can also generate:
	•	the updated status-line library for overlays
	•	vocabulary progression entries for new overlays
	•	UX text for the Interpretive Modes
	•	updated help/documentation panel language

Just say “Update the text systems” whenever you’re ready.