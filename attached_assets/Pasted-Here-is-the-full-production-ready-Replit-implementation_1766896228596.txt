Here is the full, production-ready Replit implementation prompt for adding the three new visualization modes ‚Äî Gradient Flow, Criticality, and Hysteresis/Memory ‚Äî into the existing SFD Engine without disrupting any architecture, fully optimized for technical users and casual users.

Copy/paste this entire block into Replit Agent exactly as written:

‚∏ª

‚úÖ REPLIT IMPLEMENTATION PROMPT ‚Äî SFD v1.1 Visualization Upgrade

Objective:
Integrate three new visualization modes into the SFD Engine:
	1.	Gradient Flow Map
	2.	Criticality Map
	3.	Hysteresis / Memory Map

These must be added to the existing visualization selector alongside Curvature, Tension, Coupling, Variance, and Basin modes, without modifying or removing existing functionality.

‚∏ª

üîß CORE REQUIREMENTS

1. UI Integration

Add three new options to the visualization mode selector:
	‚Ä¢	Gradient Flow
	‚Ä¢	Criticality
	‚Ä¢	Hysteresis (Memory)

Each mode should behave exactly like the existing visualization modes:
	‚Ä¢	togglable in Dual View
	‚Ä¢	compatible with Basins overlay
	‚Ä¢	compatible with Dynamic Regimes timeline
	‚Ä¢	compatible with Simulation Metrics
	‚Ä¢	accessible in both single and dual view
	‚Ä¢	minimal visual clutter
	‚Ä¢	intuitive labels + tooltips

Tooltips:
	‚Ä¢	Gradient Flow: ‚ÄúVisualizes the directional drift of the field using gradients.‚Äù
	‚Ä¢	Criticality: ‚ÄúHighlights regions approaching phase transitions or instability.‚Äù
	‚Ä¢	Hysteresis (Memory): ‚ÄúShows areas where irreversible structural change has accumulated.‚Äù

‚∏ª

üß† 2. MATHEMATICAL DEFINITIONS TO IMPLEMENT

A. Gradient Flow Map

Compute normalized gradient vectors:

const gx = dPhi_dx[x][y];
const gy = dPhi_dy[x][y];
const mag = Math.sqrt(gx*gx + gy*gy) + 1e-6;
gradientFlow[x][y] = { dx: gx/mag, dy: gy/mag, mag };

Render options:
	‚Ä¢	either directional arrows
	‚Ä¢	or a hue-wheel color encoding direction + brightness for magnitude

Use whichever is cheaper and smoother in WebGL.

‚∏ª

B. Criticality Map

Compute a scalar ‚Äúinstability index‚Äù using a simplified Hessian determinant magnitude:

const dxx = d2Phi_dx2[x][y];
const dyy = d2Phi_dy2[x][y];
const dxy = d2Phi_dxdy[x][y];

const detH = dxx * dyy - dxy * dxy;
criticality[x][y] = 1.0 / (Math.abs(detH) + 1e-6);

Normalize to 0‚Äì1 and apply a perceptually clean colormap (magma/scientific).

This map should light up where the field is near structural reorganization.

‚∏ª

C. Hysteresis / Memory Map

Track cumulative structural change across the simulation timeline.

Maintain a buffer:

memory[x][y] += Math.abs(Phi_t[x][y] - Phi_prev[x][y]);

Normalize memory buffer at each frame for visualization.

Render as a heatmap showing accumulated irreversible deformation.

‚∏ª

üé® 3. VISUAL DESIGN REQUIREMENTS

Gradient Flow
	‚Ä¢	Use subtle arrows or directional hues
	‚Ä¢	Avoid clutter
	‚Ä¢	Keep compatible with Basins overlay

Criticality
	‚Ä¢	Use vibrant, high-contrast colormap (inferno/magma)
	‚Ä¢	Highlight bifurcation zones
	‚Ä¢	Must be very legible in Dual View

Hysteresis
	‚Ä¢	Use warm-to-cool ramp (yellow/orange ‚Üí purple)
	‚Ä¢	Smooth falloff
	‚Ä¢	Must clearly reveal path-dependence

All colors must respect the current SFD style (pastel primary view, high-contrast diagnostics).

‚∏ª

‚öôÔ∏è 4. ARCHITECTURE REQUIREMENTS
	‚Ä¢	DO NOT modify existing rendering pipelines
	‚Ä¢	Add new rendering functions parallel to curvature/tension/etc
	‚Ä¢	Reuse the current shader architecture
	‚Ä¢	Keep everything efficient (no full recomputes each frame)
	‚Ä¢	Ensure all new buffers update ONLY when simulation advances
	‚Ä¢	Integrate these modes cleanly into the Dual View system
	‚Ä¢	Ensure they are available to export via PNG

‚∏ª

üß™ 5. TESTS / DIAGNOSTICS REQUIRED

Add these tests in the diagnostic panel:

Gradient Flow Tests
	‚Ä¢	Verify vector normalization
	‚Ä¢	Verify magnitude thresholding
	‚Ä¢	Verify rendering stability at low gradients

Criticality Tests
	‚Ä¢	Check Hessian calculation accuracy
	‚Ä¢	Display min/max/mean criticality values
	‚Ä¢	Show a threshold mask option

Memory Tests
	‚Ä¢	Confirm monotonic accumulation
	‚Ä¢	Confirm reset behavior when simulation resets
	‚Ä¢	Show histogram of memory distribution

‚∏ª

üìÅ 6. FOLDER / FILE GUIDANCE

Create / update the following:

/src/visualizations/gradientFlow.js
/src/visualizations/criticality.js
/src/visualizations/hysteresis.js
/src/shaders/gradientFlow.frag
/src/shaders/criticality.frag
/src/shaders/hysteresis.frag

Integrate exports in:

/src/visualizations/index.js

Add UI controls in:

/src/ui/VisualizationSelector.jsx
/src/ui/DualView.jsx

Integrate into the Simulation Engine:

/src/simulation/computeGradients.js
/src/simulation/computeHessian.js
/src/simulation/updateMemoryBuffer.js


‚∏ª

üöÄ 7. COMPLETION CHECKLIST

The upgrade is complete when:
	‚Ä¢	All three modes appear in the visualization selector
	‚Ä¢	They render correctly in both single + dual view
	‚Ä¢	Basin overlays work
	‚Ä¢	Timeline scrubbing updates them
	‚Ä¢	Diagnostics show correct values
	‚Ä¢	Performance remains smooth
	‚Ä¢	No existing mode is altered or degraded

‚∏ª

üîö FINAL ACTION

Proceed to implement all three visualization modes exactly as specified.
Ask for nothing further unless a missing dependency prevents implementation.

‚∏ª

This prompt will activate Replit Agent in full execution mode ‚Äî it contains everything needed, no ambiguity, no missing pieces.

When you‚Äôre ready, paste it directly into Replit.